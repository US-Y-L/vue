```
内容：监听器、计算属性、过滤器、生命周期
讲师：范明剑
日期：2020-11-04
```

# 一、监听器

侦听器

作用：检测变量值的变化，只要数据变化，就可以触发相应的函数执行一定的操作。

作为vue实例的配置选项，watch

## 1.普通监听

可以检测标量类型数据的变化：字符串、数字（整数、浮点数）、布尔值

当依赖的数据发生变化时，就会触发对应的函数

①写法一

```vue
<script>
	new Vue({
		el:"",
		data:{ipt:''},
		watch:{
			ipt([newVal,oldVal]){
				....
			}
		}
	})
</script>
```

②写法二

```vue
<script>
	new Vue({
		el:"",
		data:{ipt:''},
		watch:{
			ipt:{
                handler([newVal,oldVal]){...}
            }
		}
	})
</script>
```

## 2.深度监听

如果要监听的数据类型是复合类型时，普通的监听方式是无法实现，需要使用第二种写法并添加deep配置选项，来实现监听复合类型数据的变化。

复合类型：对象、数组

```vue
<script>
	new Vue({
		el:"",
		data:{
            info:{ name:'' }
        },
		watch:{
			info:{
                handler:function([newVal,oldVal]){...},
                deep:true//显示的设置为深度监听
            }
		}
	})
</script>
```

# 二、数据变化后页面不更新

解决办法：

(1)$set

```
vue.$set(target,key,value)
```

target是要改变的数据

key是数组的下标

value是要改变的内容

(2)$forceUpdate

强制重新渲染页面

(3)使用数据的相关api方法（push、shift、unshift...）

# 三、计算属性

## 1.基本使用

页面上有频繁需要进行计算得到结果，可以使用计算属性

computed

```vue
<div id="app">
	{{ 要计算的结果变量名 }}
</div>
<script>
	new Vue({
		el:"",
		computed:{
			要计算的结果变量名1(){
				计算逻辑...
				return 计算结果
			},
            要计算的结果变量名N(){
				计算逻辑...
				return 计算结果
			},
		}
	})
</script>
```

## 2.计算属性和监听的区别

相同：依赖的数据发生变化时，对应的函数会自动执行

不同：触发场景不同，监听是在页面渲染完成后，数据发生变化时，才会触发对应的函数

​		计算属性，只要页面中使用了计算属性的结果，或者依赖的数据发生变化时，就会触发对应的函数。

## 3.计算属性与函数的区别

计算属性依赖的数据，不发生变化时，不会重新执行相应的函数，因为计算属性在vue实例上产生了一个缓存。

函数调用几次，就会执行对应的函数几次，在性能上消耗比计算属性大很多。

==计算属性的结果不能直接赋值==

# 四、过滤器

作用：在页面展示数据前，可以通过过滤器对要展示的数据进行二次处理，满足一定的需求后再展示出数据。

## 1.定义

(1)全局定义

```
Vue.filter("过滤器名称",function(形参1){...})
```

(2)局部定义

```javascript
<script>
	new Vue({
		el:"",
		data:{},
		methods:{},
		watch:{},
		computed:{},
		filters:{
			过滤器名称:function(实参1){
				处理逻辑...
				return 处理结果
			}
		}
	})
</script>
```

## 2.使用

在挂载点内，通过管道符“|” 来使用定义好的过滤器。

```
{{ 要展示的变量 | 过滤器名称 }}
```

## 3.过滤器的参数

在过滤器中，第一个参数默认是管道符左边的数据

如果要传递额外的其他参数时，需要像使用函数传参一样，把过滤器名称当成函数名称，然后在后面传递额外的参数。

示例代码：

```vue
<div id="app">
	<p>
        <!-- 调用过滤器后，就会展示一个两位小数的价格 -->
        价格：{{ price | formatPrice }}
    </p>
    <p>
        <!-- 调用过滤器后，就会展示一个一位小数的价格 -->
        价格：{{ price | formatPrice(1) }}
    </p>
</div>
<script>
    new Vue({
        filters:{
            formatPrice:function(price,n=2){
                return '￥' + price.toFixed(n) + '元';
            }
        },
        el:"#app",
        data:{ price:288 }
    });
</script>
```

# 五、生命周期

vue实例从创建、挂载、更新、销毁的一个完整的过程叫做生命周期。

==钩子==函数（在指定的场景下会自动触发的函数）

## 1.页面渲染期

beforeCreate 	vue实例创建之前  创建实例就会立即调用beforeCreate()方法

created				vue实例创建完成

beforeMount	 vue实例挂载到挂载点之前

mounted			vue实例挂载到挂载点之后

## 2.页面更新期

beforeUpdate 	数据更新之前

updated				数据更新完成

## 3.页面销毁期

beforeDestroy	页面销毁之前

destroyed			页面销毁完成



## 4.常用的生命周期方法

mounted(): 可用于发送ajax请求，启动定时器等异步任务

beforeDestroy() 进行收尾工作 如：清除定时器等工作

## 六、作业

1.请求在线 JSONP 接口测试音乐接口，在页面展示时发起网络请求，并把数据展示在页面上。

2.新闻列表，新闻的标题，新闻的发布时间

时间格式是：时间戳 1604488995440

newsarr:[

​	{

​		title:"新闻标题1",

​		time:"1604488995440"

​	}

]

要求把时间戳展示成：“2020-11-04 20:10:10”